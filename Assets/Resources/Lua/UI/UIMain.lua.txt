local M = {
	mName = 'UIMain',
	mWidgets = {'UIRight'},
}
UIMain = M
setmetatable(M, UIBase)

--整个生命周期只调用一次
function M:OnLoad()
--BINDING_CODE_BEGIN
	self.mButtonNormal = self.gameObject.transform:Find('SafeArea/@Button.mButtonNormal'):GetComponent(typeof(Button))
	self.mTextNormal = self.gameObject.transform:Find('SafeArea/@Button.mButtonNormal/@Text.mTextNormal'):GetComponent(typeof(Text))
	self.mButtonPop = self.gameObject.transform:Find('SafeArea/@Button.mButtonPop'):GetComponent(typeof(Button))
	self.mButtonWidget = self.gameObject.transform:Find('SafeArea/@Button.mButtonWidget'):GetComponent(typeof(Button))
	self.mText = self.gameObject.transform:Find('SafeArea/@Text.mText'):GetComponent(typeof(Text))
	self.mVerticalGridScrollView = self.gameObject.transform:Find('SafeArea/@VerticalScrollView.mVerticalGridScrollView'):GetComponent(typeof(VerticalScrollView))
	self.mButtonAdd = self.gameObject.transform:Find('SafeArea/@Button.mButtonAdd'):GetComponent(typeof(Button))
	self.mButtonRemove = self.gameObject.transform:Find('SafeArea/@Button.mButtonRemove'):GetComponent(typeof(Button))
	self.mVerticalScrollView = self.gameObject.transform:Find('SafeArea/@VerticalScrollView.mVerticalScrollView'):GetComponent(typeof(VerticalScrollView))
	self.mHorizontalScrollView = self.gameObject.transform:Find('SafeArea/@HorizontalScrollView.mHorizontalScrollView'):GetComponent(typeof(HorizontalScrollView))
	self.mTab = self.gameObject.transform:Find('SafeArea/@Tab.mTab'):GetComponent(typeof(Tab))
	self.mProgressBar = self.gameObject.transform:Find('SafeArea/@ProgressBar.mProgressBar'):GetComponent(typeof(ProgressBar))
--BINDING_CODE_END
    self.mButtonNormal.onClick:AddListener(function() UIManager:Open(UINormal) end)
    self.mButtonPop.onClick:AddListener(function() UIManager:Open(UIPop) end)
	self.mButtonWidget.onClick:AddListener(function() UIManager:Open(UIWidget) end)
	
	self.mVerticalGridScrollView.onScrollItem:AddListener(self:OnGridScrollItem())
	self.mButtonAdd.onClick:AddListener(self:OnAddClick())
	self.mButtonRemove.onClick:AddListener(self:OnRemoveClick())

	self.mItemDic = {}

	self.mData = {21,34,5,672,23,5,21,6,124,52,6,72,13,64,234,657,42,62,21,34,5,672,23,5,21,6,124,52,6,72,13,64,234,657,42,62,21,34,5,672,23,5,21,6,124,52,6,72,13,64,234,657,42,62}
	self.mVerticalGridScrollView.totalCount = #self.mData
	self.mVerticalGridScrollView:Refill()

	self.mTab.onTabValueChanged:AddListener(self:OnTabValueChanged())

	local onValueChanged = function(from, to) 
		print("Value Change from:"..from .." to:"..to)
	end
	self.mProgressBar:SetMinMax(0,100)
	self.mProgressBar:AddListener(0, function(value) 
		print("current:" ..tostring(value)) 
		self.mProgressBar.onValueChanged:RemoveListener(onValueChanged)
		self.mProgressBar:SetValue(100,4)
	end)
	self.mProgressBar:AddListener(100,function(value) 
		print("current:" ..tostring(value)) 
		
		self.mProgressBar:SetValue(0, 4) 
	end)
	self.mProgressBar:AddListener(60,function(value) print("current:" ..tostring(value)) end)
	self.mProgressBar.onValueChanged:AddListener(onValueChanged)

	self.mProgressBar:SetValue(100,4)

end

--整个生命周期只调用一次
function M:OnUnload()
--UNBINDING_CODE_BEGIN
	self.mButtonNormal = nil
	self.mTextNormal = nil
	self.mButtonPop = nil
	self.mButtonWidget = nil
	self.mText = nil
	self.mVerticalGridScrollView = nil
	self.mButtonAdd = nil
	self.mButtonRemove = nil
	self.mVerticalScrollView = nil
	self.mHorizontalScrollView = nil
	self.mTab = nil
	self.mProgressBar = nil
--UNBINDING_CODE_END

	self.mItemDic = nil
end


--整个生命周期可能调用多次
function M:OnShow()
	
end

--整个生命周期可能调用多次
function M:OnHide()
	
end

function M:OnAddClick()
	return function ()
		for i=1,10 do
			table.insert( self.mData, i )
		end
		local preCount = self.mVerticalGridScrollView.totalCount
		self.mVerticalGridScrollView.totalCount = #self.mData
		print(preCount.." "..self.mVerticalGridScrollView.totalCount)
		self.mVerticalGridScrollView:Refresh()
		
	end
end

function M:OnRemoveClick()
	return function()
		for i=1,10 do
			table.remove( self.mData, #self.mData )
		end
		self.mVerticalGridScrollView.totalCount = #self.mData
		self.mVerticalGridScrollView:Refresh()
	end
end
--列表实例
function M:OnGridScrollItem()

	return function(item, index) 
		if self.mItemDic[item] == nil then
			local itemWrap = {
				mIndex = index, --从0开始
				mData = nil,
				mTransform = item,
				mText = item:Find("Text"):GetComponent(typeof(Text)),

			}
			function itemWrap:Init()
				self.mTransform:GetComponent(typeof(Button)).onClick:AddListener(self:OnClick())		
			end
			function itemWrap:OnClick()
				return function () 
					print("Click Item:"..self.mIndex)
				end
			end

			function itemWrap:Refresh(index, data) 
				self.mIndex = index
				self.mData = data
				self.mText.text = "Item "..self.mIndex .." data:"..data
			end

			itemWrap:Init()

			self.mItemDic[item] = itemWrap	
		end
		self.mItemDic[item]:Refresh(index, self.mData[index + 1])

	end
end
--标签页实例
function M:OnTabValueChanged()
	return function(toggle)
		local image = toggle:GetComponent(typeof(Image))
		if toggle.isOn then
			image.color = Color.yellow
		else
			image.color = Color.white
		end
	end
end

return M